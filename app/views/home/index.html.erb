<div class="flex flex-col">
  <h1 class="text-4xl font-bold text-gray-600 mb-6">Today</h1>

  <div class="mb-5"
       data-controller="trash-icon"
       data-action="click@window->trash-icon#hideAllIcons">
    <ul>
      <% @tasks.each do |task| %>
        <li class="flex items-center justify-between gap-2 py-2 border-b border-gray-300">
          <%= form_with model: task, url: task_path(task), method: :patch, local: true, class: "flex-grow" do |f| %>
          <div class="flex w-full">
            <%= f.check_box :status, { checked: task.status == "done", onchange: "this.form.submit()" }, "done", "pending" %>
            <div class="flex flex-col ml-2 w-full"
                 data-action="click->trash-icon#showIcon"
                 data-trash-icon-target="task">

              <%= f.text_field :title,
                  class: "w-full focus:outline-none focus:border-b border-gray-400 #{"line-through text-gray-500" if task.status == "done"}",
                  value: task.title,
                  onchange: "this.form.submit()",
                  autocomplete: "off" %>

              <%= f.text_field :description,
                  class: "w-full whitespace-normal break-words focus:outline-none focus:border-b border-gray-400 text-gray-500 resize-none #{"line-through" if task.status == "done"}",
                  value: task.description,
                  placeholder: "No description",
                  onchange: "this.form.submit()",
                  autocomplete: "off" %>

            </div>
          </div>
          <% end %>

          <div class="flex items-center justify-center">
            <%= button_to task_path(task),
                  method: :delete,
                  class: "text-red-600 opacity-0",
                  data: {trash_icon_target: "icon"} do %>
                <i class="fa-solid fa-trash"></i>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>

  <div>
    <%= form_with model: @task, url: tasks_path, local: true do |f| %>
      <%= f.text_field :title,
            placeholder: "Add a task...",
            autocomplete: "off",
            class: "w-full whitespace-normal break-words focus:outline-none focus:border-b border-gray-400 text-gray-500" %>
      <%= f.text_field :description,
            placeholder: "Add a description",
            autocomplete: "off",
            class: "w-full whitespace-normal break-words focus:outline-none focus:border-b border-gray-400 text-gray-500" %>
      <%= f.hidden_field :status, value: "pending" %>
      <%= f.submit "Add" %>
    <% end %>
  </div>
</div>
